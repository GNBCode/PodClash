<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="application-name" content="PodClash">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="PodClash">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#2a6b8a">
<meta name="description" content="Discover opposing views across popular podcasts on any topic.">
<link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' fill='%23e8f4f0'/%3E%3Ccircle cx='256' cy='256' r='220' fill='%232a6b8a'/%3E%3Ctext x='256' y='340' font-size='240' text-anchor='middle' font-family='Georgia,serif' fill='white'%3E%26%23127897%3B%3C/text%3E%3C/svg%3E">
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' fill='%23e8f4f0'/%3E%3Ccircle cx='256' cy='256' r='220' fill='%232a6b8a'/%3E%3Ctext x='256' y='340' font-size='240' text-anchor='middle' font-family='Georgia,serif' fill='white'%3E%26%23127897%3B%3C/text%3E%3C/svg%3E">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>PodClash ‚Äî Find Opposing Views</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500&display=swap');

  /* Mediterranean palette:
     Background: warm sea-foam / pale aqua
     Surface: crisp white with warm tint
     Accent A (left): deep Aegean blue
     Accent B (right): terracotta / sun-baked clay
     Text: deep olive-charcoal
     Muted: dusty sage
  */
  :root {
    --bg: #e8f4f0;
    --surface: #f7fbf9;
    --surface2: #dff0ea;
    --border: #b0d4c8;
    --accent-left: #2a6b8a;
    --accent-right: #c0522a;
    --accent-left-light: #dceef5;
    --accent-right-light: #f7ebe5;
    --text: #1e3a2f;
    --muted: #5a7d70;
    --vs: #2a6b8a;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
  }

  main { flex: 1; }

  header {
    padding: 2.5rem 1.5rem 2rem;
    text-align: center;
    border-bottom: 1px solid var(--border);
    background: var(--surface);
  }

  .logo {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2rem, 8vw, 4.5rem);
    font-weight: 900;
    letter-spacing: -0.02em;
    line-height: 1;
    color: var(--text);
  }

  .logo .clash { font-style: italic; color: var(--accent-left); }

  .tagline {
    font-family: 'DM Mono', monospace;
    font-size: 0.7rem;
    color: var(--muted);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-top: 0.6rem;
  }

  .search-section {
    max-width: 680px;
    margin: 2.5rem auto;
    padding: 0 1.25rem;
  }

  .search-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.68rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    display: block;
    margin-bottom: 0.6rem;
  }

  .search-row {
    display: flex;
    border: 1.5px solid var(--border);
    background: var(--surface);
    transition: border-color 0.2s;
    box-shadow: 0 2px 10px rgba(42,107,138,0.08);
  }

  .search-row:focus-within { border-color: var(--accent-left); }

  .search-row input {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    color: var(--text);
    font-family: 'Playfair Display', serif;
    font-size: clamp(1rem, 4vw, 1.35rem);
    padding: 0.9rem 1rem;
    font-style: italic;
    min-width: 0;
  }

  .search-row input::placeholder { color: var(--muted); opacity: 0.7; }

  .search-btn {
    background: var(--accent-left);
    color: #fff;
    border: none;
    cursor: pointer;
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    font-weight: 500;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 0 1.25rem;
    transition: background 0.2s, transform 0.1s;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .search-btn:hover { background: #1e4f68; }
  .search-btn:active { transform: scale(0.98); }
  .search-btn:disabled { background: var(--border); color: var(--muted); cursor: not-allowed; }

  #status-area {
    max-width: 680px;
    margin: 0 auto 1.5rem;
    padding: 0 1.25rem;
  }

  .status-line {
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    color: var(--muted);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.35rem 0;
    opacity: 0;
    transform: translateY(4px);
    transition: opacity 0.3s, transform 0.3s;
  }

  .status-line.visible { opacity: 1; transform: translateY(0); }
  .status-line.done { color: var(--accent-left); }

  .dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; flex-shrink: 0; }

  .spinner {
    width: 9px; height: 9px;
    border: 1.5px solid currentColor;
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    flex-shrink: 0;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  #results {
    max-width: 1080px;
    margin: 0 auto;
    padding: 0 1.25rem 2rem;
    display: none;
  }

  .clash-header { text-align: center; margin-bottom: 2rem; }

  .topic-pill {
    font-family: 'DM Mono', monospace;
    font-size: 0.68rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    border: 1px solid var(--border);
    background: var(--surface);
    display: inline-block;
    padding: 0.3rem 0.8rem;
    margin-bottom: 0.75rem;
  }

  .clash-header h2 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(1.3rem, 4vw, 2.2rem);
    font-weight: 700;
    color: var(--text);
  }

  .versus-layout {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: start;
    margin-bottom: 2rem;
  }

  .podcast-card {
    background: var(--surface);
    border: 1.5px solid var(--border);
    padding: 1.5rem;
    position: relative;
    box-shadow: 0 2px 12px rgba(42,107,138,0.07);
  }

  .podcast-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 4px;
  }

  .podcast-card.left::before { background: var(--accent-left); }
  .podcast-card.right::before { background: var(--accent-right); }

  .card-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.62rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-bottom: 0.6rem;
  }

  .card-label.left { color: var(--accent-left); }
  .card-label.right { color: var(--accent-right); }

  .podcast-name {
    font-family: 'Playfair Display', serif;
    font-size: clamp(1.1rem, 3vw, 1.4rem);
    font-weight: 700;
    line-height: 1.2;
    margin-bottom: 0.3rem;
    color: var(--text);
  }

  .episode-name {
    font-size: 0.82rem;
    color: var(--muted);
    font-style: italic;
    margin-bottom: 0.85rem;
    line-height: 1.4;
  }

  .ranking-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    font-family: 'DM Mono', monospace;
    font-size: 0.68rem;
    letter-spacing: 0.04em;
    padding: 0.28rem 0.65rem;
    margin-bottom: 0.75rem;
    font-weight: 500;
    border-radius: 2px;
  }

  .podcast-card.left .ranking-badge {
    background: var(--accent-left-light);
    color: var(--accent-left);
    border: 1px solid #a8cfe0;
  }

  .podcast-card.right .ranking-badge {
    background: var(--accent-right-light);
    color: var(--accent-right);
    border: 1px solid #e0c0a8;
  }
  .ranking-reason {
    font-size: 0.82rem;
    color: var(--muted);
    line-height: 1.5;
    margin-bottom: 1rem;
    padding: 0.7rem 0.85rem;
    background: var(--surface2);
    border-left: 2px solid var(--border);
    font-style: italic;
  }

  .section-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.62rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 0.35rem;
    margin-top: 1rem;
  }

  .stance-text {
    font-size: 0.95rem;
    line-height: 1.6;
    font-weight: 600;
    color: var(--text);
  }

  .summary-text {
    font-size: 0.88rem;
    line-height: 1.7;
    color: var(--muted);
  }

  .podcast-link {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.4rem;
    margin-top: 1.25rem;
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    text-decoration: none;
    padding: 0.65rem 1rem;
    border: 1.5px solid var(--border);
    color: var(--text);
    background: var(--surface2);
    transition: all 0.2s;
    font-weight: 500;
  }

  .podcast-card.left .podcast-link:hover {
    background: var(--accent-left-light);
    border-color: var(--accent-left);
    color: var(--accent-left);
  }

  .podcast-card.right .podcast-link:hover {
    background: var(--accent-right-light);
    border-color: var(--accent-right);
    color: var(--accent-right);
  }

  .vs-divider {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 1.5rem 0.75rem;
    min-width: 48px;
  }

  .vs-text {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    font-weight: 900;
    font-style: italic;
    color: var(--vs);
    writing-mode: vertical-rl;
    letter-spacing: 0.1em;
  }

  .differences-section {
    border: 1.5px solid var(--border);
    background: var(--surface);
    padding: 1.5rem;
    box-shadow: 0 2px 12px rgba(42,107,138,0.07);
    margin-bottom: 2rem;
  }

  .differences-section h3 {
    font-family: 'Playfair Display', serif;
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 1.25rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: var(--text);
  }

  .differences-section h3::after { content: ''; flex: 1; height: 1px; background: var(--border); }

  .diff-item {
    display: grid;
    grid-template-columns: 1fr 1fr;
    border: 1px solid var(--border);
    margin-bottom: 0.75rem;
    background: var(--surface2);
  }

  .diff-item:last-child { margin-bottom: 0; }

  .diff-point {
    padding: 0.9rem 1rem;
    font-size: 0.86rem;
    line-height: 1.6;
    position: relative;
    color: var(--text);
  }

  .diff-point::before {
    content: '';
    position: absolute;
    top: 0; left: 0;
    width: 3px;
    height: 100%;
  }

  .diff-point.left::before { background: var(--accent-left); }
  .diff-point.right::before { background: var(--accent-right); }
  .diff-point.right { border-left: 1px solid var(--border); }

  .diff-topic {
    font-family: 'DM Mono', monospace;
    font-size: 0.62rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 0.35rem;
  }

  .error-box {
    max-width: 680px;
    margin: 0 auto;
    padding: 1rem 1.25rem;
    border: 1px solid #e0b9a8;
    background: #fdf0ea;
    font-size: 0.88rem;
    color: var(--accent-right);
    font-family: 'DM Mono', monospace;
  }

  /* Footer */
  footer {
    text-align: center;
    padding: 1.5rem 1rem;
    border-top: 1px solid var(--border);
    background: var(--surface);
    margin-top: 2rem;
  }
.disclaimer {
    font-family: 'DM Mono', monospace;
    font-size: 0.65rem;
    color: var(--muted);
    opacity: 0.8;
    margin-bottom: 0.6rem;
    letter-spacing: 0.03em;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }
  footer a {
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    text-decoration: none;
    transition: color 0.2s;
  }

  footer a:hover { color: var(--accent-left); }

  footer a span {
    color: var(--accent-left);
    font-weight: 500;
  }

  @media (max-width: 640px) {
    header { padding: 1.75rem 1rem 1.5rem; }
    .search-section { margin: 1.75rem auto; }
    .versus-layout { grid-template-columns: 1fr; }
    .vs-divider {
      flex-direction: row;
      justify-content: center;
      padding: 0.6rem 0;
      min-width: unset;
      border-top: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      background: var(--surface2);
    }
    .vs-text { writing-mode: horizontal-tb; font-size: 1.1rem; }
    .diff-item { grid-template-columns: 1fr; }
    .diff-point.right { border-left: none; border-top: 1px solid var(--border); }
    .podcast-card { padding: 1.25rem; }
    #results { padding: 0 1rem 1.5rem; }
  }
</style>
</head>
<body>

<header>
  <div class="logo">Pod<span class="clash">Clash</span></div>
  <div class="tagline">Discover opposing views across popular podcasts</div>
</header>

<main>
  <div class="search-section">
    <label class="search-label" for="topic-input">Enter a topic to analyze</label>
    <div class="search-row">
      <input type="text" id="topic-input" placeholder="e.g. AI, vaccines, crypto, climate‚Ä¶" />
      <button class="search-btn" id="search-btn" onclick="runSearch()">Analyze ‚Üí</button>
    </div>
  </div>

  <div id="status-area"></div>
  <div id="error-area" style="max-width:680px;margin:0 auto;padding:0 1.25rem 1rem;"></div>
  <div id="results"></div>
</main>

<footer>
  <p class="disclaimer">The summaries here are AI-generated and provided for informational purposes only, as is. They may not fully represent each podcast's views. Also, sometimes links to podcasts here may not always work, because the podcasts may have been moved.</p>
  <a href="https://www.gridnewsbureau.com" target="_blank" rel="noopener">
    Powered by <span>GNB</span>
  </a>
</footer>

<script>
const STEPS = [
  "Searching for popular podcasts on this topic‚Ä¶",
  "Analyzing viewpoints and positions‚Ä¶",
  "Identifying the most contrasting perspectives‚Ä¶",
  "Generating comparison report‚Ä¶"
];

function addStatus(text) {
  const area = document.getElementById('status-area');
  const div = document.createElement('div');
  div.className = 'status-line';
  div.innerHTML = `<div class="spinner"></div><span>${text}</span>`;
  area.appendChild(div);
  requestAnimationFrame(() => div.classList.add('visible'));
  return div;
}

function markAllDone() {
  document.querySelectorAll('.status-line').forEach(el => {
    el.classList.add('done');
    const spinner = el.querySelector('.spinner');
    if (spinner) { const d = document.createElement('div'); d.className = 'dot'; spinner.replaceWith(d); }
  });
}

async function runSearch() {
  const topic = document.getElementById('topic-input').value.trim();
  if (!topic) return;

  document.getElementById('status-area').innerHTML = '';
  document.getElementById('error-area').innerHTML = '';
  document.getElementById('results').style.display = 'none';
  document.getElementById('search-btn').disabled = true;

  addStatus(STEPS[0]);
  const timers = STEPS.slice(1).map((text, i) =>
    setTimeout(() => addStatus(text), (i + 1) * 1200)
  );

  try {
    const response = await fetch('/api/analyze', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ topic })
    });

    const data = await response.json();
    if (!response.ok) throw new Error(data.error || 'Something went wrong.');

    timers.forEach(clearTimeout);
    markAllDone();
    renderResults(data);

  } catch (err) {
    timers.forEach(clearTimeout);
    markAllDone();
    document.getElementById('error-area').innerHTML =
      `<div class="error-box">‚ö† ${escHtml(err.message || 'Something went wrong. Please try again.')}</div>`;
  } finally {
    document.getElementById('search-btn').disabled = false;
  }
}

function cardHTML(pod, side) {
  return `
    <div class="podcast-card ${side}">
      <div class="card-label ${side}">‚óè Perspective ${side === 'left' ? 'A' : 'B'}</div>
      <div class="podcast-name">${escHtml(pod.name)}</div>
      <div class="episode-name">${escHtml(pod.episode)}${pod.hosts ? ' ¬∑ ' + escHtml(pod.hosts) : ''}</div>
      ${pod.rank || pod.listeners ? `<div class="ranking-badge">üéô${pod.rank ? ' Rank #' + escHtml(String(pod.rank)) : ''}${pod.listeners && pod.listeners.toLowerCase() !== 'unknown' ? ' ¬∑ ' + escHtml(pod.listeners) : ''}</div>` : ''}
${pod.why_chosen ? `<div class="ranking-reason">"${escHtml(pod.why_chosen)}"</div>` : ''}
      <div class="section-label">Their Stance</div>
      <div class="stance-text">${escHtml(pod.stance_label)}</div>
      <div class="section-label">Position Detail</div>
      <div class="summary-text">${escHtml(pod.stance_detail)}</div>
      <div class="section-label">In Depth</div>
      <div class="summary-text">${escHtml(pod.summary)}</div>
      ${pod.url ? `<a class="podcast-link" href="${escHtml(pod.url)}" target="_blank" rel="noopener">üîó Visit Podcast ‚Üó</a>` : ''}
    </div>
  `;
}

function renderResults(data) {
  const left = data.podcast_left;
  const right = data.podcast_right;

  const diffsHTML = (data.key_differences || []).map(d => `
    <div class="diff-item">
      <div class="diff-point left">
        <div class="diff-topic">${escHtml(d.dimension)} ‚Äî ${escHtml(left.name)}</div>
        ${escHtml(d.left_view)}
      </div>
      <div class="diff-point right">
        <div class="diff-topic">${escHtml(d.dimension)} ‚Äî ${escHtml(right.name)}</div>
        ${escHtml(d.right_view)}
      </div>
    </div>
  `).join('');

  document.getElementById('results').innerHTML = `
    <div class="clash-header">
      <div class="topic-pill">Topic Analysis</div>
      <h2>Opposing Views on: ${escHtml(data.topic)}</h2>
    </div>
    <div class="versus-layout">
      ${cardHTML(left, 'left')}
      <div class="vs-divider"><div class="vs-text">VS</div></div>
      ${cardHTML(right, 'right')}
    </div>
    ${diffsHTML ? `<div class="differences-section"><h3>Where They Differ</h3>${diffsHTML}</div>` : ''}
  `;

  document.getElementById('results').style.display = 'block';
  document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function escHtml(str) {
  if (!str) return '';
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

document.getElementById('topic-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') runSearch();
});
</script>
</body>
</html>
